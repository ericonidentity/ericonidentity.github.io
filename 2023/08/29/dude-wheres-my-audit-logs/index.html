
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://new.ericonidentity.com/2023/08/29/dude-wheres-my-audit-logs/">
      
      
        <link rel="prev" href="../../../07/17/protect-your-privilege-with-paw/">
      
      
        <link rel="next" href="../../../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Dude, Where's My Audit Logs? - Eric on Identity</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--nfc{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M23.958%201.98C23.895%201%2023.143.256%2022.145.197c-1.102-.066-4.668-.12-5.693-.12%201.832%201.264%202.082%203.644%202.255%208.066.101%202.62.01%2011.799.002%2012.188l-.049%202.504-9.628-9.63v-3.014l7.656%207.658c.02-1.516.04-3.492.04-5.299%200-1.76-.026-3.354-.076-4.193-.288-4.819-.737-7.077-3.253-7.962-.77-.27-1.487-.335-2.683-.351C9.728.032%202.848.037%201.854.091.8.147.09.914.042%201.9c-.048.977-.064%2019.174%200%2020.165.062.98.815%201.724%201.812%201.782%201.102.067%204.668.075%205.694.075-1.832-1.264-2.083-3.643-2.255-8.066-.1-2.62-.009-11.8%200-12.188l.047-2.504%209.629%209.63v3.013L7.312%206.152c-.02%201.514-.04%203.49-.04%205.298%200%201.76.026%203.354.077%204.192.288%204.82.736%207.077%203.252%207.962.77.271%201.487.337%202.683.352.987.012%207.868.006%208.861-.047%201.056-.056%201.765-.822%201.813-1.811.048-.976.064-19.127%200-20.118%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dude-wheres-my-audit-logs" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Eric on Identity" class="md-header__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../../../images/eidlogo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eric on Identity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Dude, Where's My Audit Logs?
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
                
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" hidden>
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Eric on Identity" class="md-nav__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../../../images/eidlogo.svg" alt="logo">

    </a>
    Eric on Identity
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../../../../archive/2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
                
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-problem" class="md-nav__link">
    <span class="md-ellipsis">
      The problem
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#missing-log-data" class="md-nav__link">
    <span class="md-ellipsis">
      Missing log data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Missing log data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#self-service-group-management" class="md-nav__link">
    <span class="md-ellipsis">
      Self-service group management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Self-service group management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#group-lifecycle-policy-changes" class="md-nav__link">
    <span class="md-ellipsis">
      Group lifecycle policy changes
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Group lifecycle policy changes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_1" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#conditional-access-custom-controls" class="md-nav__link">
    <span class="md-ellipsis">
      Conditional Access custom controls
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Conditional Access custom controls">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_2" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssprpassword-reset-settings" class="md-nav__link">
    <span class="md-ellipsis">
      SSPR/Password Reset Settings
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SSPR/Password Reset Settings">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_3" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-identities-linked-subscriptions" class="md-nav__link">
    <span class="md-ellipsis">
      External Identities linked subscriptions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External Identities linked subscriptions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_4" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#external-collaboration-settings-guest-self-service-sign-up-via-user-flows" class="md-nav__link">
    <span class="md-ellipsis">
      External collaboration settings guest self-service sign up via user flows
    </span>
  </a>
  
    <nav class="md-nav" aria-label="External collaboration settings guest self-service sign up via user flows">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_5" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#inconsistent-log-data" class="md-nav__link">
    <span class="md-ellipsis">
      Inconsistent log data
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Inconsistent log data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#entra-id-protection" class="md-nav__link">
    <span class="md-ellipsis">
      Entra ID Protection
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Entra ID Protection">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-audit-data_6" class="md-nav__link">
    <span class="md-ellipsis">
      The audit data
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#responsible-disclosure" class="md-nav__link">
    <span class="md-ellipsis">
      Responsible disclosure
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#regarding-audit-log-analysis" class="md-nav__link">
    <span class="md-ellipsis">
      Regarding audit log analysis
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content md-content--post" data-md-component="content">
    <div class="md-sidebar md-sidebar--post" data-md-component="sidebar" data-md-type="navigation">
      <div class="md-sidebar__scrollwrap">
        <div class="md-sidebar__inner md-post">
          <nav class="md-nav md-nav--primary">
            <div class="md-post__back">
              <div class="md-nav__title md-nav__container">
                <a href="../../../.." class="md-nav__link">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
                  <span class="md-ellipsis">
                    Back to index
                  </span>
                </a>
              </div>
            </div>
            
              <div class="md-post__authors md-typeset">
                
                  <div class="md-profile md-post__profile">
                    <span class="md-author md-author--long">
                      <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
                    </span>
                    <span class="md-profile__description">
                      <strong>
                        
                          <a href="https://www.ericonidentity.com">Eric Woodruff</a>
                        
                      </strong>
                      <br>
                      Identity Nerd
                    </span>
                  </div>
                
              </div>
            
            <ul class="md-post__meta md-nav__list">
              <li class="md-nav__item md-nav__item--section">
                <div class="md-post__title">
                  <span class="md-ellipsis">
                    Metadata
                  </span>
                </div>
                <nav class="md-nav">
                  <ul class="md-nav__list">
                    <li class="md-nav__item">
                      <div class="md-nav__link">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg>
                        <time datetime="2023-08-29 00:00:00+00:00" class="md-ellipsis">August 29, 2023</time>
                      </div>
                    </li>
                    
                    
                    
                      
                      <li class="md-nav__item">
                        <div class="md-nav__link">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg>
                          <span class="md-ellipsis">
                            
                              10 min read
                            
                          </span>
                        </div>
                      </li>
                    
                  </ul>
                </nav>
              </li>
            </ul>
            
          </nav>
          
        </div>
      </div>
    </div>
    <article class="md-content__inner md-typeset">
      
        
  




<h1 id="dude-wheres-my-audit-logs">Dude, Where's My Audit Logs?</h1>
<p>Audit logs can provide all sorts of wonderful points of data. In the interest of identity security, we have historically seen that we can glean rich sets of information around what’s happening in a directory service with some properly functioning audit logging. For many identity practitioners, there is the expectation that while we may not always look at the audit logs or their details, if or when we need them, they’ll be there to help us understand whatever it is we are investigating. Same goes for compliance and auditing as well.</p>
<p>Considering that customers have no ability to impact what or how auditing happens in Entra ID, in the shared responsibility model, it’s on Microsoft to ensure all events are audited.</p>
<p><img alt="Figure 1" src="/images/2023/08/29/img1.png" /></p>
<p><em>Shared responsiblity model, courtesy Microsoft, with identity and directory infrastructure highlighted.</em></p>
<p>Microsoft documents what is audited in Entra ID, which you can find here, <a href="https://learn.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities?WT.mc_id=SEC-MVP-5005105">Azure Active Directory (Azure AD) audit activity reference – Microsoft Entra | Microsoft Learn</a>.</p>
<h2 id="the-problem">The problem</h2>
<p>I’ve recently been down the rabbit hole part time picking apart Entra ID audit logs, and in my analysis of the audit log data for Entra ID, some audit logs slot into one of two buckets:</p>
<ul>
<li>Data is missing</li>
<li>Data is inconsistent/poor quality</li>
</ul>
<p><img alt="Figure 2" src="/images/2023/08/29/img2.jpg" /></p>
<p><em>Or perhaps in our case, what has been unseen cannot be seen.</em></p>
<p>To be fair, a broad set of changes <strong>are</strong> audited in Entra ID, but at the same time I found it rather surprising that <strong>most SSPR</strong> configuration changes are not properly audited, which, if you look at the document above, Microsoft does not seem to argue. Considering recent events that surface what is logged in Entra ID and the M365 ecosystem, in this persons opinion Microsoft should be continually striving to audit 100% of all configuration changes in Entra ID.</p>
<h2 id="missing-log-data">Missing log data</h2>
<p>These are instances where Entra ID log data is incomplete, usually in that the modified properties data is null.</p>
<h3 id="self-service-group-management">Self-service group management</h3>
<p>Neither of these settings are exposed via the Graph API, so the reference point for their control is under Entra ID -&gt; Groups -&gt; Group settings</p>
<p><img alt="Figure 3" src="/images/2023/08/29/img3.png" /></p>
<h4 id="the-audit-data">The audit data</h4>
<p>Note an absence of the actual change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:04:39.1390262+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update authorization policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;User-Agent&quot;,
                &quot;value&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;
            }
        ],
        &quot;category&quot;: &quot;AuthorizationPolicy&quot;,
        &quot;correlationId&quot;: &quot;1349713e-116b-4246-9c64-60b394884488&quot;,
        &quot;id&quot;: &quot;Directory_1349713e-116b-4246-9c64-60b394884488_NANEA_29121908&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Authorization Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;4bb7b039-71e4-474e-a7fc-5fe0bbf86fcc&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Other&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="group-lifecycle-policy-changes">Group lifecycle policy changes</h3>
<p>More commonly known as the group expiration settings, the controls for these in the portal can be found under Groups -&gt; Group settings -&gt; Expiration.</p>
<p><img alt="Figure 4" src="/images/2023/08/29/img4.png" /></p>
<p>These are also exposed through Graph, <a href="https://graph.microsoft.com/beta/groupLifecyclePolicies/">https://graph.microsoft.com/beta/groupLifecyclePolicies/</a>.</p>
<h4 id="the-audit-data_1">The audit data</h4>
<p>Note the absence of any change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>    {
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:09:38.6970558+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update lifecycle management policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;GroupManagement&quot;,
        &quot;correlationId&quot;: &quot;8883b045-774b-4107-b85a-04df5252b5ad&quot;,
        &quot;id&quot;: &quot;SSGM_8883b045-774b-4107-b85a-04df5252b5ad_KLKOT_36197055&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.x&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Self-service Group Management&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;OK&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: null,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;57126178-623b-4468-a96e-be2ee1611cc4&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="conditional-access-custom-controls">Conditional Access custom controls</h3>
<p>Now I get that this is a deprecated public preview, but, it’s also existed for quite a long time, and it’s surprising that changes to the control itself are not audited.</p>
<h4 id="the-audit-data_2">The audit data</h4>
<p>Note the absence of any change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>    {
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:18:39.6114596+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;21476eae-1b3f-45db-8e3e-e190cd19ad44&quot;,
        &quot;id&quot;: &quot;Directory_21476eae-1b3f-45db-8e3e-e190cd19ad44_USKAS_28366729&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Default Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;77a1c6e8-877e-43fe-a4d0-0806472fe4a0&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="ssprpassword-reset-settings">SSPR/Password Reset Settings</h3>
<p>Microsoft documents that most changes to SSPR are not audited, and in my analysis found that the following settings do not properly reflect any data in the audit logs, including a few that Microsoft seems to indicate should, such as enabling/disabling on-premises integration.</p>
<p>Considering that these changes impact tenant-wide security controls around SSPR, it’s surprising this service has existed for so long with what is effectively non-existent auditing. These logs don’t even indicate who initiated the change.</p>
<p>Yes, some of these are being overhauled/changed as authentication methods is an area of focus for Microsoft right now, but not all of these settings are encompassed in that.</p>
<ul>
<li>Registration, Days before users are asked to re-confirm their settings</li>
<li>Notification settings</li>
<li>Customizations</li>
<li>On-premises integration</li>
<li>Self-service password reset enablement/scoping</li>
<li>Authentication methods (legacy methods)</li>
</ul>
<h4 id="the-audit-data_3">The audit data</h4>
<p>In testing, there isn’t even a direct audit event logged for changes, but simply an update to the <strong>Microsoft password reset service service</strong> principle. The update provides no information on the actual change.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:28:04.2244435+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update service principal&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;AppId&quot;,
                &quot;value&quot;: &quot;93625bc8-bfe2-437a-97e0-3d0060024faa&quot;
            }
        ],
        &quot;category&quot;: &quot;ApplicationManagement&quot;,
        &quot;correlationId&quot;: &quot;aae6519f-15d9-4dec-9d12-a03b2639c60e&quot;,
        &quot;id&quot;: &quot;Directory_aae6519f-15d9-4dec-9d12-a03b2639c60e_F0I2G_33925192&quot;,
        &quot;initiatedBy&quot;: {
            &quot;app&quot;: {
                &quot;appId&quot;: null,
                &quot;displayName&quot;: &quot;Microsoft password reset service&quot;,
                &quot;servicePrincipalId&quot;: &quot;a96c060c-dd1c-4229-9089-72aed43d85db&quot;,
                &quot;servicePrincipalName&quot;: null
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Microsoft password reset service&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;a96c060c-dd1c-4229-9089-72aed43d85db&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;TargetId.ServicePrincipalNames&quot;,
                        &quot;newValue&quot;: &quot;\&quot;https://passwordreset.microsoftonline.com;https://passwordreset.microsoftonline.com/;93625bc8-bfe2-437a-97e0-3d0060024faa\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;ServicePrincipal&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="external-identities-linked-subscriptions">External Identities linked subscriptions</h3>
<p>Microsoft has been pushing the migration of B2B guests/External Identities to use a linked subscription where organizations will receive 50,000 MAU for guests as far as licensing goes, compared to the prior model of a 1:5 user: guest license ratio.</p>
<p>In order to implement this change, an organization must link their Entra ID tenant with an Azure subscription for billing purposes.</p>
<p>When implementing this change, there <strong>is</strong> a proper audit even in the subscriptions activity log, however, a change like this should also be reflected in Entra ID audit logs. Instead, we get a series of useless audit log entries.</p>
<h4 id="the-audit-data_4">The audit data</h4>
<p>When looking at the data in either entry for <strong>Create or update a Guest Usages resource</strong>, there is no data of value for the change.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:38:06.5858394+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Create or update a Guest Usages resource&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;targetTenant&quot;,
                &quot;value&quot;: &quot;Undefined tenant&quot;
            },
            {
                &quot;key&quot;: &quot;targetEntityType&quot;,
                &quot;value&quot;: &quot;Resource&quot;
            },
            {
                &quot;key&quot;: &quot;actorIdentityType&quot;,
                &quot;value&quot;: &quot;UPN&quot;
            }
        ],
        &quot;category&quot;: &quot;ResourceManagement&quot;,
        &quot;correlationId&quot;: &quot;dda8b5c0-125d-4fc6-b8aa-971e9cb27f9a&quot;,
        &quot;id&quot;: &quot;B2C_dda8b5c0-125d-4fc6-b8aa-971e9cb27f9a_VUR48_6835487&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: null,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;B2C&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: null,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;NotSet&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: null,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Directory&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="external-collaboration-settings-guest-self-service-sign-up-via-user-flows">External collaboration settings guest self-service sign up via user flows</h3>
<p>Guest self-service sign-up (SSSU) is what one could consider a grey area in the B2B/B2C space, allowing users to self-register as guests in your tenant and access designated resources. While a somewhat niche feature, it’s something that is rather powerful for controlling access to enterprise applications.</p>
<p><img alt="Figure 5" src="/images/2023/08/29/img5.png" /></p>
<p>This setting can also be adjusted via Graph at <a href="https://graph.microsoft.com/v1.0/policies/authenticationFlowsPolicy">https://graph.microsoft.com/v1.0/policies/authenticationFlowsPolicy</a>.</p>
<p>Surprisingly, changes that enable/disable this setting are not audited effectively.</p>
<h4 id="the-audit-data_5">The audit data</h4>
<p>Toggling this on/off results in a long series of audit events from the B2C service, however, none of them actually indicate the change.</p>
<p><img alt="Figure 6" src="/images/2023/08/29/img6.png" /></p>
<p>For all of these, the <strong>Modified Properties</strong> is null</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:49:50.9366119+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update authentication flows policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;targetTenant&quot;,
                &quot;value&quot;: &quot;Undefined tenant&quot;
            },
            {
                &quot;key&quot;: &quot;targetEntityType&quot;,
                &quot;value&quot;: &quot;None&quot;
            },
            {
                &quot;key&quot;: &quot;actorIdentityType&quot;,
                &quot;value&quot;: &quot;UPN&quot;
            }
        ],
        &quot;category&quot;: &quot;ResourceManagement&quot;,
        &quot;correlationId&quot;: &quot;923307cf-b8ac-4e26-bd47-53650a88e9fb&quot;,
        &quot;id&quot;: &quot;B2C_923307cf-b8ac-4e26-bd47-53650a88e9fb_VUR48_6870123&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: null,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;B2C&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: null,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: null,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;NotSet&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Other&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h2 id="inconsistent-log-data">Inconsistent log data</h2>
<p>These are instances where changes are audited, however, they seem to disregard any sort of schema or consistency of auditing in Entra ID.</p>
<h3 id="entra-id-protection">Entra ID Protection</h3>
<p>Entra ID Protection heavily offenses the senses with its audit logging of changes to the following policies:</p>
<ul>
<li>User risk policy</li>
<li>Sign-in risk policy</li>
<li>Multifactor authentication registration policy</li>
</ul>
<p>We could argue that you shouldn’t be using the MFA registration policy at this point, as MFA should be an account day zero requirement. And while Microsoft wants you to move your ID Protection policies into Conditional Access, until they are gone, the changes really break the audit mold.</p>
<h4 id="the-audit-data_6">The audit data</h4>
<p>Oddly the user risk policy and MFA registration policy indicate an update if either is changed, and updates to the sign-in risk policy appear separate. But for all three, two events are logged, a core directory change that contains no data, and secondary policy change, that oddly describes the change data under <strong>Status reason</strong>, which is highlighted in blue below. Where one should/would expect the change to appear is highlighted in yellow.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-30T03:00:57.8173676+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update Sign-In Risk Policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;bcda8418-f5f0-42f4-a8c1-cc809be64050&quot;,
        &quot;id&quot;: &quot;ADIbizaUX_bcda8418-f5f0-42f4-a8c1-cc809be64050_MZXCC_6463221&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;AAD Management UX&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;Set sign-in risk policy successful. Enabled: True. Risk level for MFA: Never. Risk level for block: High. Include All Users: False. Include Users: 788aff42-e628-4ff9-8e17-a207350ed80b. Include Groups: . Exclude All Users: False. Exclude Users . Exclude Groups &quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Sign-In Risk Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;5bf6637e-056a-4f1c-b887-6c7e99ed5ac6&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: &quot;&quot;
    },
    {
        &quot;activityDateTime&quot;: &quot;2023-08-30T03:00:57.181057+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;User-Agent&quot;,
                &quot;value&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;
            }
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;b06b42f1-4723-45bb-b205-59eae5ab7da3&quot;,
        &quot;id&quot;: &quot;Directory_b06b42f1-4723-45bb-b205-59eae5ab7da3_FYNFV_398999217&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Sign-In Risk Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;5bf6637e-056a-4f1c-b887-6c7e99ed5ac6&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h2 id="responsible-disclosure">Responsible disclosure</h2>
<p>After consideration and reading of what constitutes a security vulnerability at the Microsoft Security Response Center (MSRC), I do not believe that these deficiencies in auditing would be considered a security vulnerability, as the absence of audit data itself is not a vulnerability.</p>
<p>On July 26th, 2023, through an MVP channel in the Customer Connected Program Entra Advisors, I reached out to the Microsoft Entra Product Group wanting to provide feedback on what I believe are audit gaps in Entra ID.</p>
<p>After some exchanges to coordinate whom to send the feedback to, on August 7th I provided an email to the responsible parties in the PG covering audit logging. Microsoft did reply that they will investigate in response. Considering that this is not a security vulnerability, I do not believe there is harm in publishing this material prior to any (if any) changes occur on the part of Microsoft.</p>
<p>A case with Microsoft support has not been opened on this subject to this point, on which I would open one if directed by the PG.</p>
<h2 id="regarding-audit-log-analysis">Regarding audit log analysis</h2>
<p>In my endeavors to this point, I have not analyzed <strong>all</strong> audit log events in Entra ID, so there may still be additional gaps in what one might find to be acceptable auditing. While Microsoft may contend that they indicate in their own docs that some of these changes are not listed as being audited, I would counter that with the stances that every single configuration change in Entra ID should be audited <strong>and</strong> adhere to some sort of audit log schema for consistency.</p>







  
  




  



      
    </article>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.path", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"NFC": "nfc"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>