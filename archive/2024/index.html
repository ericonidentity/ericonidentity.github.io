
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://new.ericonidentity.com/archive/2024/">
      
      
        <link rel="prev" href="../2025/">
      
      
        <link rel="next" href="../2023/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>2024 - Eric on Identity</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--nfc{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M23.958%201.98C23.895%201%2023.143.256%2022.145.197c-1.102-.066-4.668-.12-5.693-.12%201.832%201.264%202.082%203.644%202.255%208.066.101%202.62.01%2011.799.002%2012.188l-.049%202.504-9.628-9.63v-3.014l7.656%207.658c.02-1.516.04-3.492.04-5.299%200-1.76-.026-3.354-.076-4.193-.288-4.819-.737-7.077-3.253-7.962-.77-.27-1.487-.335-2.683-.351C9.728.032%202.848.037%201.854.091.8.147.09.914.042%201.9c-.048.977-.064%2019.174%200%2020.165.062.98.815%201.724%201.812%201.782%201.102.067%204.668.075%205.694.075-1.832-1.264-2.083-3.643-2.255-8.066-.1-2.62-.009-11.8%200-12.188l.047-2.504%209.629%209.63v3.013L7.312%206.152c-.02%201.514-.04%203.49-.04%205.298%200%201.76.026%203.354.077%204.192.288%204.82.736%207.077%203.252%207.962.77.271%201.487.337%202.683.352.987.012%207.868.006%208.861-.047%201.056-.056%201.765-.822%201.813-1.811.048-.976.064-19.127%200-20.118%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2024" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Eric on Identity" class="md-header__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eric on Identity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2024
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Eric on Identity" class="md-nav__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    Eric on Identity
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2024">2024</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-26 00:00:00+00:00">March 26, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              10 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="the-intersection-of-graph-and-entra-id-application-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/">The Intersection of Graph and Entra ID: Application Permissions and Roles</a></h2>
<p>When you build software that talks to Microsoft Entra ID, you eventually run into the question of which Microsoft Graph permissions to use. That question has gotten a lot more attention after the Midnight Blizzard intrusion at Microsoft, where attackers appear to have abused service principals and Graph permissions inside Microsoft’s own tenant.</p>
<p>For background on that incident and what it means for Azure and Entra admins, Andy Robbins has an excellent write-up that’s worth reading.</p>
<h3 id="primer-on-the-microsoft-graph-api"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#primer-on-the-microsoft-graph-api">Primer on the Microsoft Graph API</a></h3>
<p>Before diving into the details of application permissions and roles, it helps to level-set how Microsoft Graph works. If you already live and breathe Graph, feel free to skim this section.</p>
<h4 id="what-is-graph-api"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#what-is-graph-api">What is Graph API</a></h4>
<p>The Microsoft Graph API is the unified REST endpoint for most Microsoft 365 services, including Entra ID. In this post, when we say “Graph” or “Graph API,” we’re talking about Microsoft Graph specifically.</p>
<p><img alt="Microsoft Graph API Diagram" src="img1.png" /></p>
<p>You can think of Graph as the front door: behind it sit services such as Entra ID, Exchange Online, SharePoint, Teams, and more. Most modern integrations with Microsoft 365 are built on top of Graph.</p>
<p>Microsoft’s official documentation is the best place to go for a deeper overview of Graph’s capabilities and supported workloads.</p>
<h4 id="what-are-application-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#what-are-application-permissions">What are Application Permissions</a></h4>
<p>Graph exposes two major permission types:</p>
<ul>
<li><strong>Delegated permissions</strong> – the app acts on behalf of a user.</li>
<li><strong>Application permissions</strong> – the app acts as itself, without a signed-in user.</li>
</ul>
<p>In this article we’ll focus on <strong>application permissions</strong>. These are what you typically use for things like scheduled scripts, daemon services, or backend services that manage Entra ID objects on a schedule.  </p>
<p>A classic example is a script that creates or updates user objects in Entra ID. If it’s running as a background process, it should authenticate as an application (service principal) and rely on application permissions.</p>
<p>Many third-party SaaS products do the same: they authenticate as an app, not a person, and use application permissions to perform tasks like reading all calendars in Exchange Online or managing directory data.</p>
<p>Delegated permissions, in contrast, are about acting in the context of a user – e.g., an app that reads <em>my</em> OneDrive or <em>my</em> calendar after I sign in and consent.</p>
<h4 id="how-graph-interacts-with-entra-id"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#how-graph-interacts-with-entra-id">How Graph Interacts with Entra ID</a></h4>
<p>When you call Graph, the path in the URL determines which service you’re actually talking to. You don’t call Entra ID directly; you call Graph, and Graph routes the request.</p>
<p><img alt="Example breakdown of a Graph URL" src="img2.png" /></p>
<p>A Graph request has a couple of important pieces:</p>
<ul>
<li>The <strong>version/endpoint</strong> (<code>v1.0</code> or <code>beta</code>), and  </li>
<li>The <strong>resource</strong> path (users, groups, directoryObjects, etc.).</li>
</ul>
<p>In most everyday use, you don’t have to worry about which backend service is involved; Graph figures that out based on the resource path. It does start to matter when you run into throttling. Different resource families are backed by different services, each with its own limits. If you see a 429 response from Graph, you’re hitting those throttling limits.</p>
<p>Microsoft publishes service-specific throttling guidance that’s worth reviewing if you’re automating heavily against Graph.</p>
<h4 id="talking-to-graph"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#talking-to-graph">Talking to Graph</a></h4>
<p>Graph is a REST API, so you use HTTP methods to interact with it. If you come from a traditional sysadmin background, the mapping between CRUD concepts and HTTP verbs looks like this:</p>
<table>
<thead>
<tr>
<th>CRUD operation</th>
<th>HTTP method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create</td>
<td>POST</td>
</tr>
<tr>
<td>Read</td>
<td>GET</td>
</tr>
<tr>
<td>Update</td>
<td>PATCH / PUT</td>
</tr>
<tr>
<td>Delete</td>
<td>DELETE</td>
</tr>
</tbody>
</table>
<p>In practice, most update operations for Entra ID resources use <strong>PATCH</strong> rather than PUT. There are only a handful of Entra operations that use PUT.</p>
<p>Tools like <strong>Graph Explorer</strong> make it easier to get hands-on with the API and see the raw requests and responses.</p>
<h3 id="exploring-application-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#exploring-application-permissions">Exploring application permissions</a></h3>
<p>If you’ve spent time with Active Directory access control lists and access control entries, the idea of permissions in Entra ID is not completely foreign—but the model is different enough that it’s worth walking through.</p>
<h4 id="where-permissions-exist"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#where-permissions-exist">Where permissions exist</a></h4>
<p>In on-prem Active Directory, you attach permissions directly to the <strong>target objects</strong>. For example, if Sarah needs to reset passwords, you grant the <strong>Reset password</strong> right on user objects (often via an OU so it inherits to multiple users).</p>
<p><img alt="High-level permission relationship in Active Directory" src="img3.png" /></p>
<p>To allow Todd to create new groups, you’d grant him a “create group objects” right on an OU. The OU is the container, and the permissions cascade to the objects underneath it.</p>
<p><img alt="Granting create-group permissions in an OU" src="img4.png" /></p>
<p>You can think of service accounts the same way: whether it’s a gMSA or a user account acting as a service account, you still attach permissions to the objects being protected.</p>
<p><img alt="Service account permission relationship in Active Directory" src="img5.png" /></p>
<p>In Entra ID, Graph API permissions work differently. Permissions are applied to the <strong>requesting service principal</strong>, not to the target objects. App registrations describe what an application <em>wants</em>, but the <strong>service principal</strong> is what actually holds the delegated and application permission grants.</p>
<p>If you’re fuzzy on the difference between app registrations and enterprise applications, it’s worth reviewing that first – app registrations are the app definitions, whereas enterprise applications (service principals) are the instances in a tenant.</p>
<p>Application permissions show up as <strong>appRoleAssignment</strong> resources linked to the service principal.</p>
<p>Imagine an example where an application needs to create a group.</p>
<p><img alt="Application permissions to create a group" src="img6.png" /></p>
<p>Here, a backend service (“Cloud Application”) authenticates as a service principal. That service principal has been granted the Graph application permission <strong>Group.Create</strong>, which allows it to create groups in Entra ID.</p>
<p>From an operational security perspective, we should treat these service principals as modern service accounts. Anywhere we can replace a traditional user-based service account with a service principal in Entra ID, we should. That applies just as much to one-off admin scripts as it does to ISV software.</p>
<h4 id="consenting-to-graph-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#consenting-to-graph-permissions">Consenting to Graph permissions</a></h4>
<p>In the Entra admin center, you specify required permissions on the <strong>app registration</strong>. That’s only half the story, though – the permissions must also be <strong>granted</strong> in the tenant.</p>
<p>That’s what <strong>admin consent</strong> does: it approves the requested Graph permissions for your organization.</p>
<p>There are two small but important nuances:</p>
<ul>
<li>Both the app registration blade and the enterprise application blade have a <strong>Grant admin consent</strong> button. They perform the same operation; the button on the app registration blade is just there for convenience.</li>
<li>Only <strong>Global Administrator</strong> can grant consent for <strong>Microsoft Graph application permissions</strong>. While documentation often suggests that Application Administrator or Cloud Application Administrator can grant consent, that does not apply to Graph app perms.</li>
</ul>
<h3 id="putting-permissions-into-action"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#putting-permissions-into-action">Putting permissions into action</a></h3>
<p>Let’s walk through a simple scenario where an application uses Graph application permissions to create groups in Entra ID.</p>
<p>We’ve created a new application, <strong>Cloud Application</strong>, and granted it the <strong>Group.Create</strong> application permission. After consenting to the permission, we can see it listed on the service principal.</p>
<p><img alt="Cloud Application with Group.Create permission" src="img7.png" /></p>
<p>For this walkthrough we’ll use the <strong>Microsoft Graph PowerShell SDK</strong> to talk to Graph.</p>
<p>We connect using application credentials (for example, a client secret or certificate) and specify our tenant ID. We can then confirm our context with <code>Get-MgContext</code>.</p>
<p><img alt="Get-MgContext showing Group.Create scope" src="img8.png" /></p>
<p>The output shows that we’re connected as the <strong>Cloud Application</strong> app, and the <code>Scopes</code> field includes the application permission we assigned.</p>
<p>Next, we create a group using the SDK.</p>
<p><img alt="Creating a group via Graph PowerShell" src="img9.png" /></p>
<p>If we look at the Entra audit logs, we can see the group creation event attributed to the Cloud Application service principal.</p>
<p><img alt="Audit log details – Activity tab" src="img10.png" /></p>
<p><img alt="Audit log details – Modified properties" src="img11.png" /></p>
<p>However, because the app only has <strong>Group.Create</strong>, it can’t update or delete the group. Attempts to delete the group fail with an authorization error.</p>
<p><img alt="403 when trying to delete a group with only Group.Create" src="img12.png" /></p>
<h3 id="when-application-permissions-can-become-tricky"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#when-application-permissions-can-become-tricky">When application permissions can become tricky</a></h3>
<p>Suppose we decide the app should be able to delete groups as well. Our initial intuition might be that there’s a <strong>Group.Delete</strong> permission we can add, similar to the precision we’re used to in AD.</p>
<p>When we look at Graph’s available application permissions for groups, reality looks different.</p>
<p><img alt="Available Graph application permissions for groups" src="img13.png" /></p>
<p>In addition to Group.Create, the only other group-related application permissions are:</p>
<ul>
<li><strong>Group.Read.All</strong></li>
<li><strong>Group.ReadWrite.All</strong></li>
</ul>
<p>To let the app delete groups, we have to assign <strong>Group.ReadWrite.All</strong>, which effectively gives it full read/write access across all groups in the tenant.</p>
<p><img alt="Service principal with Group.Create and Group.ReadWrite.All" src="img14.png" /></p>
<p>After we add the permission, disconnect, and reconnect, we can see both scopes in <code>Get-MgContext</code>.</p>
<p><img alt="Get-MgContext showing both application permissions" src="img15.png" /></p>
<p>Now a deletion that previously failed succeeds without error.</p>
<p><img alt="Successfully deleting a group via Graph PowerShell" src="img16.png" /></p>
<p>We can also add users to the group using the same context.</p>
<p><img alt="Adding a group member via Graph PowerShell" src="img17.png" /></p>
<p>The catch is obvious: we wanted the ability to manage <strong>some</strong> groups, but Group.ReadWrite.All applies to <strong>all</strong> groups in the directory. That’s where Entra roles, combined with admin units, can help.</p>
<h3 id="roles-can-fill-the-application-permission-granularity-gap-somewhat"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#roles-can-fill-the-application-permission-granularity-gap-somewhat">Roles can fill the application permission granularity gap – somewhat</a></h3>
<p>Our desired scenario is to let the application manage only a subset of groups, not every group in the tenant.</p>
<p><img alt="Desired scenario – manage only certain groups" src="img18.png" /></p>
<p>In traditional Active Directory, we’d solve this by organizing groups into a dedicated OU and applying granular permissions on that OU (or on specific group objects).</p>
<p>In Entra ID, we can approximate this pattern using <strong>Administrative Units (AUs)</strong> and directory roles.</p>
<p>First, we strip away the Graph application permissions we’ve granted.</p>
<p><img alt="Removing Graph application permissions from the app" src="img19.png" /></p>
<p>Then we assign the <strong>Groups Administrator</strong> role to the Cloud Application service principal, scoped to a specific administrative unit.</p>
<p><img alt="Groups Administrator role scoped to an administrative unit" src="img20.png" /></p>
<p>When we connect to Graph and run <code>Get-MgContext</code>, we see that there are no Graph scopes present. The app doesn’t have application permissions anymore, but it <em>does</em> have the directory role assignment in Entra.</p>
<p><img alt="Get-MgContext with no Graph scopes" src="img21.png" /></p>
<p>If we try to modify a group that sits <strong>outside</strong> the scoped administrative unit, the operation fails—exactly what we want.</p>
<p><em>(screenshot of failed attempt to modify an out-of-scope group – img22.png)</em></p>
<p>When we target a group that <strong>is</strong> in the administrative unit, the operation succeeds.</p>
<p><img alt="Successfully managing a group in the scoped administrative unit" src="img23.png" /></p>
<p>So now, our combination of permissions and roles gives us the ability to manage just the groups we’ve scoped to the AU.</p>
<p><img alt="Role and permissions model for managing a group in an administrative unit" src="img24.png" /></p>
<p>However, this model is somewhat restrictive. In the example above, we already know the object ID of the group we want to modify. If we don’t, we might want to list the groups in the administrative unit.</p>
<p>With only the current role assignment, we can’t enumerate them via Graph.</p>
<p><img alt="Attempt to enumerate groups in the AU fails" src="img25.png" /></p>
<h3 id="getting-into-the-thick-of-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#getting-into-the-thick-of-permissions-and-roles">Getting into the thick of permissions and roles</a></h3>
<p>At this point the pattern becomes clear: to perform operations as an application, we need some combination of <strong>Graph application permissions</strong> and <strong>directory roles</strong> that together authorize the actions we care about.</p>
<p>To list objects in the administrative unit, we add <strong>AdministrativeUnit.Read.All</strong> to the application.</p>
<p><img alt="Adding AdministrativeUnit.Read.All" src="img26.png" /></p>
<p>With that permission in place, we can enumerate members of the administrative unit via Graph.</p>
<p><img alt="Successfully enumerating objects in the administrative unit" src="img27.png" /></p>
<p>If we also want to enumerate users in the tenant to decide who to place in the group, that’s another permission. If we want to check whether a group already exists before we create it, that’s yet another permission.</p>
<p><img alt="Additional permissions required for users and groups" src="img28.png" /></p>
<p>For a relatively small set of operations—creating and managing certain groups, reading users, and scoping everything to an AU—we end up with a permission and role model that looks something like:</p>
<ul>
<li>Graph application permissions:</li>
<li>AdministrativeUnit.Read.All  </li>
<li>Group.Read.All / Group.ReadWrite.All (depending on needs)  </li>
<li>User.Read.All</li>
<li>Directory role:</li>
<li>Groups Administrator, scoped to the administrative unit</li>
</ul>
<p>Real-world software that manages large slices of Entra ID or Microsoft 365 tends to accumulate a lot of these permissions quickly. The more capabilities the tool has, the broader the Graph permissions usually need to be.</p>
<h3 id="take-the-time-to-understand-and-test-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#take-the-time-to-understand-and-test-permissions-and-roles">Take the time to understand, and test, permissions and roles</a></h3>
<p>Permissions and roles for applications in Entra ID can look intimidating at first, but understanding how they interact is critical if you want to secure your tenant.</p>
<p>A few practical takeaways:</p>
<ul>
<li>Invest the time to understand how Graph application permissions and directory roles overlap and differ.</li>
<li>Test your apps in a lab tenant to verify the <strong>minimum</strong> set of permissions they actually need.</li>
<li>Treat service principals as first-class security identities, just like user accounts or gMSAs.</li>
<li>Regularly review which apps have powerful permissions such as <code>*.Read.All</code> and <code>*.ReadWrite.All</code>.</li>
</ul>
<p>The goal is to ensure your apps and scripts only have the access they truly need. Otherwise, they become extremely attractive targets for lateral movement and privilege escalation.</p>
<h3 id="about-this-posts-featured-image"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#about-this-posts-featured-image">About This Post’s Featured Image</a></h3>
<p>The featured image for this post is a photograph by Danielle Rice, used under the Unsplash license.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"NFC": "nfc"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>