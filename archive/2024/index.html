
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://new.ericonidentity.com/archive/2024/">
      
      
        <link rel="prev" href="../2025/">
      
      
        <link rel="next" href="../2023/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>2024 - Eric on Identity</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--nfc{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M23.958%201.98C23.895%201%2023.143.256%2022.145.197c-1.102-.066-4.668-.12-5.693-.12%201.832%201.264%202.082%203.644%202.255%208.066.101%202.62.01%2011.799.002%2012.188l-.049%202.504-9.628-9.63v-3.014l7.656%207.658c.02-1.516.04-3.492.04-5.299%200-1.76-.026-3.354-.076-4.193-.288-4.819-.737-7.077-3.253-7.962-.77-.27-1.487-.335-2.683-.351C9.728.032%202.848.037%201.854.091.8.147.09.914.042%201.9c-.048.977-.064%2019.174%200%2020.165.062.98.815%201.724%201.812%201.782%201.102.067%204.668.075%205.694.075-1.832-1.264-2.083-3.643-2.255-8.066-.1-2.62-.009-11.8%200-12.188l.047-2.504%209.629%209.63v3.013L7.312%206.152c-.02%201.514-.04%203.49-.04%205.298%200%201.76.026%203.354.077%204.192.288%204.82.736%207.077%203.252%207.962.77.271%201.487.337%202.683.352.987.012%207.868.006%208.861-.047%201.056-.056%201.765-.822%201.813-1.811.048-.976.064-19.127%200-20.118%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2024" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Eric on Identity" class="md-header__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eric on Identity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2024
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Eric on Identity" class="md-nav__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    Eric on Identity
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2023/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2024">2024</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2024-03-26 00:00:00+00:00">March 26, 2024</time></li>
        
        
          
          <li class="md-meta__item">
            
              12 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="the-intersection-of-graph-and-entra-id-application-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/">The Intersection of Graph and Entra ID: Application Permissions and Roles</a></h2>
<p>When you work someplace that develops software that interacts with Entra ID, the question of Graph permissions eventually comes up. With the recent Midnight Blizzard attack against Microsoft, where a threat actor appears to have used service principals and Graph permissions to access resources in Microsoft’s own Entra tenant, the scrutiny on permissions grows even more intense. You can read more about this with a great write-up from Andy Robbins here, <a href="https://posts.specterops.io/microsoft-breach-what-happened-what-should-azure-admins-do-da2b7e674ebc">Microsoft Breach — What Happened? What Should Azure Admins Do? | by Andy Robbins | Feb, 2024 | Posts By SpecterOps Team Members</a>.</p>
<h3 id="primer-on-the-microsoft-graph-api"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#primer-on-the-microsoft-graph-api">Primer on the Microsoft Graph API</a></h3>
<p>Before jumping into the permission weeds, let’s review a few things to set the stage. If you already understand the Graph API basics, feel free to scroll past.</p>
<h4 id="what-is-graph-api"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#what-is-graph-api">What is Graph API</a></h4>
<p>The Microsoft Graph API is the unified API endpoint into <strong>most</strong> Microsoft 365 services, which includes Entra ID. For purposes of this article, the terms Graph and Graph API refer to the Microsoft Graph API.</p>
<p><img alt="Figure 1" src="/images/2024/03/26/img1.png" /></p>
<p><em>Microsoft Graph API diagram / Courtesy Microsoft Learn</em></p>
<p>You can read more of an overview about the Graph API here, <a href="https://learn.microsoft.com/en-us/graph/overview?WT.mc_id=SEC-MVP-5005105">Microsoft Graph overview – Microsoft Graph | Microsoft Learn</a>.</p>
<h4 id="what-are-application-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#what-are-application-permissions">What are application permissions</a></h4>
<p>In Graph, there are two permission types, <strong>Delegated</strong>, and <strong>Application</strong>. The focus of this article is on application permissions, which allow an application to interact with Microsoft Graph, and the associated Microsoft services, without needing the context of a user.</p>
<p>A common example might be scripts an organization developed that manage user objects in Entra ID – while there are robust third-party solutions that can also manage this stuff, many orgs still run scripts to maintain directory data. If the script is running as a scheduled task in something, somewhere, it’s likely using application permissions (or hopefully is).</p>
<p>Most third-party software applications that interact with Microsoft 365 without a user context use application permissions – this way their software can do its software “things” behind the scenes, not centered around a user, for whatever purpose the software exists. If the software is a conference room integration it might require the ability to read <strong>all</strong> calendars in Exchange Online.</p>
<p>We won’t cover delegated permissions here, but for reference, these are permissions that allow an application to access resources on behalf of a user. A good example would be an application that wants to save files to OneDrive or read a calendar in Exchange Online. In this instance, the application is acting in the context of the user.</p>
<h4 id="how-graph-interacts-with-entra-id"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#how-graph-interacts-with-entra-id">How Graph interacts with Entra ID</a></h4>
<p>As mentioned, Graph is the one-stop shop for all Microsoft 365 resources, including Entra ID. When you query Graph, the service you are reaching out to is derived from the path in the URL.</p>
<p><img alt="Figure 2" src="/images/2024/03/26/img2.png" /></p>
<p>If we break down this example, we see two primary components:</p>
<ul>
<li>The <strong>version</strong> or <strong>endpoint</strong>. These terms are both used in Microsoft documentation and can be thought of interchangeably – this is what determines whether you are hitting the v1.0 or beta endpoint.</li>
<li>The <strong>resource</strong>. The resource is a component of the <strong>service</strong>, but we don’t need to make a specific reference to the service within the Graph API call, we can just let Graph determine what service to call on the backend based on the resource we are looking to interact with.</li>
</ul>
<p>One time that it <strong>does</strong> become important to know what service relates to the resources you are accessing is when you are heavily interacting with Graph, and potentially hitting the dreaded <strong>429 response</strong>, which is the error you’ll receive back from Graph if your requests are being throttled.</p>
<p>Throttled or not, if you are curious to get an idea of how resources are aggregated into different services, check out the throttling limits here, <a href="https://learn.microsoft.com/en-us/graph/throttling-limits?WT.mc_id=SEC-MVP-5005105">Microsoft Graph service-specific throttling limits – Microsoft Graph | Microsoft Learn</a>.</p>
<h4 id="talking-to-graph"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#talking-to-graph">Talking to Graph</a></h4>
<p>As Microsoft Graph is a REST API, you use HTTP methods to interact with it. Those with a stronger sysadmin background, and less of a developer background, can be challenged to learn Graph times, but using <a href="https://developer.microsoft.com/en-us/graph/graph-explorer?WT.mc_id=SEC-MVP-5005105">Graph Explorer</a> helps accelerate that process.</p>
<p>It also helps to understand how the basic CRUD operations of a directory service translate into HTTP methods:</p>
<table>
<thead>
<tr>
<th>CRUD Operation</th>
<th>HTTP Method</th>
</tr>
</thead>
<tbody>
<tr>
<td>Create</td>
<td>POST</td>
</tr>
<tr>
<td>Read</td>
<td>GET</td>
</tr>
<tr>
<td>Update</td>
<td>PATCH</td>
</tr>
<tr>
<td>Update</td>
<td>PUT</td>
</tr>
<tr>
<td>Delete</td>
<td>DELETE</td>
</tr>
</tbody>
</table>
<p>The translation is mostly 1:1. You’ll notice that both PUT and PATCH are options for updating; searching the Graph API reference there are only five operations against Entra that use PUT. Point being, most update operations with Entra ID are going to use PATCH.</p>
<h3 id="exploring-application-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#exploring-application-permissions">Exploring Application permissions</a></h3>
<p>If you are familiar with Access Control Lists and Access Control Entries in Active Directory, understanding permissions in Entra ID is not as difficult to grasp upfront as it might seem. For simplicity we’ll stick to using the term permissions, and not delve into all the nuances of DACLS and ACE and the such that compose security in Active Directory, but if you want to read more, Microsoft has a nice article on them from an identity security perspective here, <a href="https://techcommunity.microsoft.com/t5/security-compliance-and-identity/active-directory-access-control-list-8211-attacks-and-defense/ba-p/250315">Active Directory Access Control List – Attacks and Defense – Microsoft Community Hub</a>.</p>
<h4 id="where-permissions-exist"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#where-permissions-exist">Where permissions exist</a></h4>
<p>In Active Directory permissions are attached to the target objects, things like users and groups. If I want to grant Sarah permission to change a user’s password, I will apply those permissions onto the user objects, granting Sarah <strong>Reset password</strong>.</p>
<p>In many instances the permissions are applied onto an Organizational Unit (OU) and inherited down onto the objects, so I could also grant Sarah <strong>Reset password</strong> on an OU, and she would have the ability to reset the password of all users inheriting that entry in the OU.</p>
<p><img alt="Figure 3" src="/images/2024/03/26/img3.png" /></p>
<p><em>Permission relationship in Active Directory</em></p>
<p>The above diagram is high-level, not intended to describe the actual password reset process and the mechanisms that perform an access check in Active Directory, but to just help visualize the relationship.</p>
<p>Similarly, if I wanted to allow Todd to create new groups, I would grant Create Group objects onto an OU; since the group doesn’t exist, you have many scenarios where you are applying the permissions onto the structure above.</p>
<p><img alt="Figure 4" src="/images/2024/03/26/img4.png" /></p>
<p>In Active Directory, whether a real service account that’s a gMSA, or a user acting as a service account, the same model applies.</p>
<p><img alt="Figure 5" src="/images/2024/03/26/img5.png" /></p>
<p><em>Permission relationship in Active Directory for a service account</em></p>
<p>In Entra ID, Graph API permissions are applied on the requesting service principal, not on the target object. While an app registration is used to describe the desired permissions, the service principal is the object that holds the relationship to the delegated and application permission grants. If you are still uncertain of the difference between app registrations and enterprise applications, take a look at my deep dive here, <a href="https://ericonidentity.com/2023/03/11/aad-app-registrations-and-enterprise-applications-the-definitive-guide/">Entra App Registrations and Enterprise Applications: The Definitive Guide – Eric on Identity</a>.</p>
<p>Application permissions are held as an appRoleAssignment resource type and are associated with a service principal.</p>
<p>If we look at the example of creating a group, the permissions will look like the following:</p>
<p><img alt="Figure 6" src="/images/2024/03/26/img6.png" /></p>
<p><em>Application permissions to create a group</em></p>
<p>In this example, the application, a daemon, or backend type service, has the credentials necessary to authenticate to Entra ID as the service principal Cloud Application. Cloud Application has been given Graph API permissions of <strong>Group.Create</strong>, and subsequently can create a group in Entra ID.</p>
<p>While the focus for service principals heavily targets developers, we should also think of service principals as <strong>modern service accounts</strong>. Just as we want to replace user-based service accounts with gMSA in Active Directory, wherever we can replace user objects with service principals in Entra ID, we want to do the same. For all those one-off scripts that we run as sysadmins, start looking service principals as a replacement.</p>
<h4 id="consenting-to-graph-permissions"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#consenting-to-graph-permissions">Consenting to Graph permissions</a></h4>
<p>When you create an app registration, you can go through and specify the permissions you want. In the Entra admin center portal, we must specify the permissions we want on the app registration.</p>
<p>But how do we put those permissions into action? Through admin consent. Admin consent is the process of approving the requested permissions in your Entra tenant. While it may feel confusing, because app registrations and service principals serve multiple purposes for single and multi-tenant applications, even in a single-tenant app, you need to approve the permissions you are requesting.</p>
<p>Admin consent has two additional and slightly confusing parts to it:</p>
<ul>
<li>Both the app registration and enterprise application blade in the Entra admin center have a <strong>Grant admin consent</strong> button. <strong>They both do the same exact thing</strong>. The button is added for convenience to the app registration blade. That’s it. If you are creating an application that is going to be used by something like a script, it saves you the time of having to move between two different sections of the portal.</li>
<li>Only a <strong>Global Administrator</strong> can grant consent to the Microsoft Graph API. Microsoft documentation will highlight that <strong>Application Administrator</strong> and <strong>Cloud Application Administrator</strong> role owners can grant consent, however, they <strong>cannot</strong> for Microsoft Graph.</li>
</ul>
<h3 id="putting-permissions-into-action"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#putting-permissions-into-action">Putting permissions into action</a></h3>
<p>Let’s walk through what it looks like to use application permissions in Entra ID.</p>
<p>We’ve created a new application, <strong>Cloud Application</strong>, and we’ve specified and consented to the <strong>Group.Create</strong> permission.</p>
<p><img alt="Figure 7" src="/images/2024/03/26/img7.png" /></p>
<p>For purposes of this article we’ll be walking through connecting to Graph using the <a href="https://learn.microsoft.com/en-us/powershell/microsoftgraph/overview?view=graph-powershell-1.0?WT.mc_id=SEC-MVP-5005105">Microsoft Graph PowerShell SDK</a>.</p>
<p>We’ve already configured our credentials, so we just specify the credentials and the tenant ID to connect to Graph. We then can also verify the context we are authenticated with by using <strong>Get-MGContext</strong>.</p>
<p><img alt="Figure 8" src="/images/2024/03/26/img8.png" /></p>
<p>Looking at the output, we can see that we are connected as the application, and under scopes, we see the application permission assigned.</p>
<p>Let’s create a group.</p>
<p><img alt="Figure 9" src="/images/2024/03/26/img9.png" /></p>
<p>We can check our audit logs and indeed see that the group was created by the Cloud Application</p>
<p><img alt="Figure 10" src="/images/2024/03/26/img10.png" /></p>
<p><img alt="Figure 11" src="/images/2024/03/26/img11.png" /></p>
<p>As we only have the <strong>Group.Create</strong> permission, while we can go on a spree creating hundreds of groups, we can’t update or delete them.</p>
<p><img alt="Figure 12" src="/images/2024/03/26/img12.png" /></p>
<h3 id="when-application-permissions-can-become-tricky"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#when-application-permissions-can-become-tricky">When application permissions can become tricky</a></h3>
<p>We want our application to have the ability to delete groups.</p>
<p>When we go into the permissions for Graph, what we’ll find is that some of the precision we desire, and perhaps expect coming from the world of Active Directory, does not exist. We had a specific Group.Create permissions, so one might expect Group.Update, Group.Delete, and so on… unfortunately expectations will not be met here.</p>
<p><img alt="Figure 13" src="/images/2024/03/26/img13.png" /></p>
<p>We can see that of the available application permissions for group, the only other options are Group.Read.All, and Group.ReadWrite.All. <strong>Group.ReadWrite.All</strong> provides us the ability to delete groups, but this ability extends across all groups in the Entra tenant.</p>
<p><img alt="Figure 14" src="/images/2024/03/26/img14.png" /></p>
<p><em>Application permissions to create, manage, and delete groups</em></p>
<p>We add our new permission, disconnect, and then reconnect to Graph. We can see our new permission is available under scopes.</p>
<p><img alt="Figure 15" src="/images/2024/03/26/img15.png" /></p>
<p>With a simple one-liner, we can delete the group we had previously created, this time with no error.</p>
<p><img alt="Figure 16" src="/images/2024/03/26/img16.png" /></p>
<p>We can now also add users to the group.</p>
<p><img alt="Figure 17" src="/images/2024/03/26/img17.png" /></p>
<p>What if we want to allow the same permissions but only on certain groups? That’s where application permissions start to fall short, and roles might become part of the solution.</p>
<h3 id="roles-can-fill-the-application-permission-granularity-gap-somewhat"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#roles-can-fill-the-application-permission-granularity-gap-somewhat">Roles can fill the application permission granularity gap - somewhat</a></h3>
<p>The problem we are facing is we want a scenario that looks like the following: the ability to only manage certain groups.</p>
<p><img alt="Figure 18" src="/images/2024/03/26/img18.png" /></p>
<p><em>Our desired scenario</em></p>
<p>With Active Directory, we could just move the groups into a sub OU and set the permissions, or if necessary, directly on the groups we wanted to allow the granular permissions for.</p>
<p>With Entra ID, we can use Administrative Units similarly, but we’ll find out that there are lots of caveats.</p>
<p>Let’s explore managing groups in an administrative unit. First, we remove all of our Graph API permissions.</p>
<p><img alt="Figure 19" src="/images/2024/03/26/img19.png" /></p>
<p>Then we grant the <strong>Group Administrator</strong> role to Cloud Application, but we scope it to a target administrative unit.</p>
<p><img alt="Figure 20" src="/images/2024/03/26/img20.png" /></p>
<p>We connect to Graph and run <strong>Get-MGContext</strong> to verify that we have no scopes (permissions). We can’t see from Get-MGContext that we have the role assignment, but it’s there.</p>
<p><img alt="Figure 21" src="/images/2024/03/26/img21.png" /></p>
<p><em>Note the lack of scopes (permissions)</em></p>
<p>We can verify that we don’t have permissions across the directory by attempting to add a user to a group that exists outside the scope of our administrative unit.</p>
<p><img alt="Figure 22" src="/images/2024/03/26/img22.png" /></p>
<p>Now let’s try adding a user to a group that we have scoped to an administrative unit.</p>
<p><img alt="Figure 23" src="/images/2024/03/26/img23.png" /></p>
<p>Great! So now we have the granular ability to update this group, and our combination of permissions and roles looks like this.</p>
<p><img alt="Figure 24" src="/images/2024/03/26/img24.png" /></p>
<p><em>Role and permissions necessary to update a group in an administrative unit</em></p>
<p>But the model we are operating with is inherently quite restrictive. In the example we know the Object ID of the group we want to modify. But what if we don’t know what groups we have permissions to manage? We could enumerate the groups in the administrative unit.</p>
<p>Except, we can’t, at least not with the permissions and roles in scope.</p>
<p><img alt="Figure 25" src="/images/2024/03/26/img25.png" /></p>
<h3 id="getting-into-the-thick-of-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#getting-into-the-thick-of-permissions-and-roles">Getting into the thick of permissions and roles</a></h3>
<p>We are starting to see that to perform actions as an application, it must either have associated permissions or roles assigned that grant the necessary actions.</p>
<p>We add permissions for <strong>AdministrativeUnit.Read.All</strong> to our application.</p>
<p><img alt="Figure 26" src="/images/2024/03/26/img26.png" /></p>
<p>And now we can enumerate the objects in our administrative unit.</p>
<p><img alt="Figure 27" src="/images/2024/03/26/img27.png" /></p>
<p>But what if we want to enumerate users to determine who to place in the group? Again, it’s another permission.</p>
<p><img alt="Figure 28" src="/images/2024/03/26/img28.png" /></p>
<p>And if we want a way to determine if a group already exists before creating it? Yup, another permission.</p>
<p><img alt="Figure 29" src="/images/2024/03/26/img29.png" /></p>
<p>For the handful of operations here, we now have the following permission and role model.</p>
<p><img alt="Figure 30" src="/images/2024/03/26/img30.png" /></p>
<p>Whether it’s a homegrown set of internal processes managing user or group lifecycles in Entra ID, or a software solution from an ISV, either deployed on-prem or consumed as a SaaS application, the permissions necessary can rapidly expand depending on the type of service being offered, especially if the software is providing broad management or tooling for Entra ID, or likely any M365 service.</p>
<h3 id="take-the-time-to-understand-and-test-permissions-and-roles"><a class="toclink" href="../../2024/03/26/the-intersection-of-graph-and-entra-id-application-permissions-and-roles/#take-the-time-to-understand-and-test-permissions-and-roles">Take the time to understand, and test, permissions and roles</a></h3>
<p>While the landscape of permissions and roles might be something less ventured, building an understanding of how they work, their strengths, their weaknesses, and the reality of how they work within Graph and Entra ID is critical to protecting our resources and enterprises. While it may be a little work upfront, refining your applications, scripts, and processes to only use the necessary permissions can go a long way in ensuring that it’s not the next point of lateral movement or privilege escalation.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"NFC": "nfc"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>