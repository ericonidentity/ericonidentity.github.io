
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://new.ericonidentity.com/archive/2023/">
      
      
        <link rel="prev" href="../2024/">
      
      
        <link rel="next" href="../2022/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>2023 - Eric on Identity</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


  
  
    
      
      
        
      
      
    
  
  
  <style>:root{.md-tag.md-tag--nfc{--md-tag-icon:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M23.958%201.98C23.895%201%2023.143.256%2022.145.197c-1.102-.066-4.668-.12-5.693-.12%201.832%201.264%202.082%203.644%202.255%208.066.101%202.62.01%2011.799.002%2012.188l-.049%202.504-9.628-9.63v-3.014l7.656%207.658c.02-1.516.04-3.492.04-5.299%200-1.76-.026-3.354-.076-4.193-.288-4.819-.737-7.077-3.253-7.962-.77-.27-1.487-.335-2.683-.351C9.728.032%202.848.037%201.854.091.8.147.09.914.042%201.9c-.048.977-.064%2019.174%200%2020.165.062.98.815%201.724%201.812%201.782%201.102.067%204.668.075%205.694.075-1.832-1.264-2.083-3.643-2.255-8.066-.1-2.62-.009-11.8%200-12.188l.047-2.504%209.629%209.63v3.013L7.312%206.152c-.02%201.514-.04%203.49-.04%205.298%200%201.76.026%203.354.077%204.192.288%204.82.736%207.077%203.252%207.962.77.271%201.487.337%202.683.352.987.012%207.868.006%208.861-.047%201.056-.056%201.765-.822%201.813-1.811.048-.976.064-19.127%200-20.118%22/%3E%3C/svg%3E');}}</style>

    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#2023" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Eric on Identity" class="md-header__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Eric on Identity
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              2023
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Eric on Identity" class="md-nav__button md-logo" aria-label="Eric on Identity" data-md-component="logo">
      
  <img src="../../images/eidlogo.svg" alt="logo">

    </a>
    Eric on Identity
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Archive
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Archive
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2025/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2025
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2024/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2024
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
      
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    2023
    
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2022/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2022
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
  
  
    <li class="md-nav__item">
      <a href="../2021/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    2021
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
  <div class="md-content" data-md-component="content">
    <div class="md-content__inner">
      <header class="md-typeset">
        <h1 id="2023">2023</h1>
      </header>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-08-29 00:00:00+00:00">August 29, 2023</time></li>
        
        
          
          <li class="md-meta__item">
            
              10 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="dude-wheres-my-audit-logs"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/">Dude, Where's My Audit Logs?</a></h2>
<p>Audit logs can provide all sorts of wonderful points of data. In the interest of identity security, we have historically seen that we can glean rich sets of information around what’s happening in a directory service with some properly functioning audit logging. For many identity practitioners, there is the expectation that while we may not always look at the audit logs or their details, if or when we need them, they’ll be there to help us understand whatever it is we are investigating. Same goes for compliance and auditing as well.</p>
<p>Considering that customers have no ability to impact what or how auditing happens in Entra ID, in the shared responsibility model, it’s on Microsoft to ensure all events are audited.</p>
<p><img alt="Figure 1" src="/images/2023/08/29/img1.png" /></p>
<p><em>Shared responsiblity model, courtesy Microsoft, with identity and directory infrastructure highlighted.</em></p>
<p>Microsoft documents what is audited in Entra ID, which you can find here, <a href="https://learn.microsoft.com/en-us/azure/active-directory/reports-monitoring/reference-audit-activities?WT.mc_id=SEC-MVP-5005105">Azure Active Directory (Azure AD) audit activity reference – Microsoft Entra | Microsoft Learn</a>.</p>
<h3 id="the-problem"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-problem">The problem</a></h3>
<p>I’ve recently been down the rabbit hole part time picking apart Entra ID audit logs, and in my analysis of the audit log data for Entra ID, some audit logs slot into one of two buckets:</p>
<ul>
<li>Data is missing</li>
<li>Data is inconsistent/poor quality</li>
</ul>
<p><img alt="Figure 2" src="/images/2023/08/29/img2.jpg" /></p>
<p><em>Or perhaps in our case, what has been unseen cannot be seen.</em></p>
<p>To be fair, a broad set of changes <strong>are</strong> audited in Entra ID, but at the same time I found it rather surprising that <strong>most SSPR</strong> configuration changes are not properly audited, which, if you look at the document above, Microsoft does not seem to argue. Considering recent events that surface what is logged in Entra ID and the M365 ecosystem, in this persons opinion Microsoft should be continually striving to audit 100% of all configuration changes in Entra ID.</p>
<h3 id="missing-log-data"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#missing-log-data">Missing log data</a></h3>
<p>These are instances where Entra ID log data is incomplete, usually in that the modified properties data is null.</p>
<h4 id="self-service-group-management"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#self-service-group-management">Self-service group management</a></h4>
<p>Neither of these settings are exposed via the Graph API, so the reference point for their control is under Entra ID -&gt; Groups -&gt; Group settings</p>
<p><img alt="Figure 3" src="/images/2023/08/29/img3.png" /></p>
<h5 id="the-audit-data"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data">The audit data</a></h5>
<p>Note an absence of the actual change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:04:39.1390262+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update authorization policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;User-Agent&quot;,
                &quot;value&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;
            }
        ],
        &quot;category&quot;: &quot;AuthorizationPolicy&quot;,
        &quot;correlationId&quot;: &quot;1349713e-116b-4246-9c64-60b394884488&quot;,
        &quot;id&quot;: &quot;Directory_1349713e-116b-4246-9c64-60b394884488_NANEA_29121908&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Authorization Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;4bb7b039-71e4-474e-a7fc-5fe0bbf86fcc&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Other&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h4 id="group-lifecycle-policy-changes"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#group-lifecycle-policy-changes">Group lifecycle policy changes</a></h4>
<p>More commonly known as the group expiration settings, the controls for these in the portal can be found under Groups -&gt; Group settings -&gt; Expiration.</p>
<p><img alt="Figure 4" src="/images/2023/08/29/img4.png" /></p>
<p>These are also exposed through Graph, <a href="https://graph.microsoft.com/beta/groupLifecyclePolicies/">https://graph.microsoft.com/beta/groupLifecyclePolicies/</a>.</p>
<h5 id="the-audit-data_1"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_1">The audit data</a></h5>
<p>Note the absence of any change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>    {
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:09:38.6970558+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update lifecycle management policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;GroupManagement&quot;,
        &quot;correlationId&quot;: &quot;8883b045-774b-4107-b85a-04df5252b5ad&quot;,
        &quot;id&quot;: &quot;SSGM_8883b045-774b-4107-b85a-04df5252b5ad_KLKOT_36197055&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.x&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Self-service Group Management&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;OK&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: null,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;57126178-623b-4468-a96e-be2ee1611cc4&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h4 id="conditional-access-custom-controls"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#conditional-access-custom-controls">Conditional Access custom controls</a></h4>
<p>Now I get that this is a deprecated public preview, but, it’s also existed for quite a long time, and it’s surprising that changes to the control itself are not audited.</p>
<h5 id="the-audit-data_2"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_2">The audit data</a></h5>
<p>Note the absence of any change data, as highlighted in the audit event:</p>
<div class="highlight"><pre><span></span><code>    {
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:18:39.6114596+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;21476eae-1b3f-45db-8e3e-e190cd19ad44&quot;,
        &quot;id&quot;: &quot;Directory_21476eae-1b3f-45db-8e3e-e190cd19ad44_USKAS_28366729&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Default Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;77a1c6e8-877e-43fe-a4d0-0806472fe4a0&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h4 id="ssprpassword-reset-settings"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#ssprpassword-reset-settings">SSPR/Password Reset Settings</a></h4>
<p>Microsoft documents that most changes to SSPR are not audited, and in my analysis found that the following settings do not properly reflect any data in the audit logs, including a few that Microsoft seems to indicate should, such as enabling/disabling on-premises integration.</p>
<p>Considering that these changes impact tenant-wide security controls around SSPR, it’s surprising this service has existed for so long with what is effectively non-existent auditing. These logs don’t even indicate who initiated the change.</p>
<p>Yes, some of these are being overhauled/changed as authentication methods is an area of focus for Microsoft right now, but not all of these settings are encompassed in that.</p>
<ul>
<li>Registration, Days before users are asked to re-confirm their settings</li>
<li>Notification settings</li>
<li>Customizations</li>
<li>On-premises integration</li>
<li>Self-service password reset enablement/scoping</li>
<li>Authentication methods (legacy methods)</li>
</ul>
<h5 id="the-audit-data_3"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_3">The audit data</a></h5>
<p>In testing, there isn’t even a direct audit event logged for changes, but simply an update to the <strong>Microsoft password reset service service</strong> principle. The update provides no information on the actual change.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:28:04.2244435+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update service principal&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;AppId&quot;,
                &quot;value&quot;: &quot;93625bc8-bfe2-437a-97e0-3d0060024faa&quot;
            }
        ],
        &quot;category&quot;: &quot;ApplicationManagement&quot;,
        &quot;correlationId&quot;: &quot;aae6519f-15d9-4dec-9d12-a03b2639c60e&quot;,
        &quot;id&quot;: &quot;Directory_aae6519f-15d9-4dec-9d12-a03b2639c60e_F0I2G_33925192&quot;,
        &quot;initiatedBy&quot;: {
            &quot;app&quot;: {
                &quot;appId&quot;: null,
                &quot;displayName&quot;: &quot;Microsoft password reset service&quot;,
                &quot;servicePrincipalId&quot;: &quot;a96c060c-dd1c-4229-9089-72aed43d85db&quot;,
                &quot;servicePrincipalName&quot;: null
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Microsoft password reset service&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;a96c060c-dd1c-4229-9089-72aed43d85db&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;TargetId.ServicePrincipalNames&quot;,
                        &quot;newValue&quot;: &quot;\&quot;https://passwordreset.microsoftonline.com;https://passwordreset.microsoftonline.com/;93625bc8-bfe2-437a-97e0-3d0060024faa\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;ServicePrincipal&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h4 id="external-identities-linked-subscriptions"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#external-identities-linked-subscriptions">External Identities linked subscriptions</a></h4>
<p>Microsoft has been pushing the migration of B2B guests/External Identities to use a linked subscription where organizations will receive 50,000 MAU for guests as far as licensing goes, compared to the prior model of a 1:5 user: guest license ratio.</p>
<p>In order to implement this change, an organization must link their Entra ID tenant with an Azure subscription for billing purposes.</p>
<p>When implementing this change, there <strong>is</strong> a proper audit even in the subscriptions activity log, however, a change like this should also be reflected in Entra ID audit logs. Instead, we get a series of useless audit log entries.</p>
<h5 id="the-audit-data_4"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_4">The audit data</a></h5>
<p>When looking at the data in either entry for <strong>Create or update a Guest Usages resource</strong>, there is no data of value for the change.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:38:06.5858394+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Create or update a Guest Usages resource&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;targetTenant&quot;,
                &quot;value&quot;: &quot;Undefined tenant&quot;
            },
            {
                &quot;key&quot;: &quot;targetEntityType&quot;,
                &quot;value&quot;: &quot;Resource&quot;
            },
            {
                &quot;key&quot;: &quot;actorIdentityType&quot;,
                &quot;value&quot;: &quot;UPN&quot;
            }
        ],
        &quot;category&quot;: &quot;ResourceManagement&quot;,
        &quot;correlationId&quot;: &quot;dda8b5c0-125d-4fc6-b8aa-971e9cb27f9a&quot;,
        &quot;id&quot;: &quot;B2C_dda8b5c0-125d-4fc6-b8aa-971e9cb27f9a_VUR48_6835487&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: null,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;B2C&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: null,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;NotSet&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: null,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Directory&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h4 id="external-collaboration-settings-guest-self-service-sign-up-via-user-flows"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#external-collaboration-settings-guest-self-service-sign-up-via-user-flows">External collaboration settings guest self-service sign up via user flows</a></h4>
<p>Guest self-service sign-up (SSSU) is what one could consider a grey area in the B2B/B2C space, allowing users to self-register as guests in your tenant and access designated resources. While a somewhat niche feature, it’s something that is rather powerful for controlling access to enterprise applications.</p>
<p><img alt="Figure 5" src="/images/2023/08/29/img5.png" /></p>
<p>This setting can also be adjusted via Graph at <a href="https://graph.microsoft.com/v1.0/policies/authenticationFlowsPolicy">https://graph.microsoft.com/v1.0/policies/authenticationFlowsPolicy</a>.</p>
<p>Surprisingly, changes that enable/disable this setting are not audited effectively.</p>
<h5 id="the-audit-data_5"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_5">The audit data</a></h5>
<p>Toggling this on/off results in a long series of audit events from the B2C service, however, none of them actually indicate the change.</p>
<p><img alt="Figure 6" src="/images/2023/08/29/img6.png" /></p>
<p>For all of these, the <strong>Modified Properties</strong> is null</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-07T20:49:50.9366119+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update authentication flows policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;targetTenant&quot;,
                &quot;value&quot;: &quot;Undefined tenant&quot;
            },
            {
                &quot;key&quot;: &quot;targetEntityType&quot;,
                &quot;value&quot;: &quot;None&quot;
            },
            {
                &quot;key&quot;: &quot;actorIdentityType&quot;,
                &quot;value&quot;: &quot;UPN&quot;
            }
        ],
        &quot;category&quot;: &quot;ResourceManagement&quot;,
        &quot;correlationId&quot;: &quot;923307cf-b8ac-4e26-bd47-53650a88e9fb&quot;,
        &quot;id&quot;: &quot;B2C_923307cf-b8ac-4e26-bd47-53650a88e9fb_VUR48_6870123&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: null,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;B2C&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: null,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: null,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;NotSet&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Other&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="inconsistent-log-data"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#inconsistent-log-data">Inconsistent log data</a></h3>
<p>These are instances where changes are audited, however, they seem to disregard any sort of schema or consistency of auditing in Entra ID.</p>
<h4 id="entra-id-protection"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#entra-id-protection">Entra ID Protection</a></h4>
<p>Entra ID Protection heavily offenses the senses with its audit logging of changes to the following policies:</p>
<ul>
<li>User risk policy</li>
<li>Sign-in risk policy</li>
<li>Multifactor authentication registration policy</li>
</ul>
<p>We could argue that you shouldn’t be using the MFA registration policy at this point, as MFA should be an account day zero requirement. And while Microsoft wants you to move your ID Protection policies into Conditional Access, until they are gone, the changes really break the audit mold.</p>
<h5 id="the-audit-data_6"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#the-audit-data_6">The audit data</a></h5>
<p>Oddly the user risk policy and MFA registration policy indicate an update if either is changed, and updates to the sign-in risk policy appear separate. But for all three, two events are logged, a core directory change that contains no data, and secondary policy change, that oddly describes the change data under <strong>Status reason</strong>, which is highlighted in blue below. Where one should/would expect the change to appear is highlighted in yellow.</p>
<div class="highlight"><pre><span></span><code>{
        &quot;activityDateTime&quot;: &quot;2023-08-30T03:00:57.8173676+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update Sign-In Risk Policy&quot;,
        &quot;additionalDetails&quot;: [
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;bcda8418-f5f0-42f4-a8c1-cc809be64050&quot;,
        &quot;id&quot;: &quot;ADIbizaUX_bcda8418-f5f0-42f4-a8c1-cc809be64050_MZXCC_6463221&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;AAD Management UX&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;Set sign-in risk policy successful. Enabled: True. Risk level for MFA: Never. Risk level for block: High. Include All Users: False. Include Users: 788aff42-e628-4ff9-8e17-a207350ed80b. Include Groups: . Exclude All Users: False. Exclude Users . Exclude Groups &quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Sign-In Risk Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;5bf6637e-056a-4f1c-b887-6c7e99ed5ac6&quot;,
                &quot;modifiedProperties&quot;: [
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: &quot;&quot;
    },
    {
        &quot;activityDateTime&quot;: &quot;2023-08-30T03:00:57.181057+00:00&quot;,
        &quot;activityDisplayName&quot;: &quot;Update policy&quot;,
        &quot;additionalDetails&quot;: [
            {
                &quot;key&quot;: &quot;User-Agent&quot;,
                &quot;value&quot;: &quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0&quot;
            }
        ],
        &quot;category&quot;: &quot;Policy&quot;,
        &quot;correlationId&quot;: &quot;b06b42f1-4723-45bb-b205-59eae5ab7da3&quot;,
        &quot;id&quot;: &quot;Directory_b06b42f1-4723-45bb-b205-59eae5ab7da3_FYNFV_398999217&quot;,
        &quot;initiatedBy&quot;: {
            &quot;user&quot;: {
                &quot;displayName&quot;: null,
                &quot;homeTenantId&quot;: null,
                &quot;homeTenantName&quot;: null,
                &quot;id&quot;: &quot;d7148226-7444-4884-aef7-b5fe693a6798&quot;,
                &quot;ipAddress&quot;: &quot;X.X.X.X&quot;,
                &quot;userPrincipalName&quot;: &quot;ga-x@x.onmicrosoft.com&quot;
            }
        },
        &quot;loggedByService&quot;: &quot;Core Directory&quot;,
        &quot;result&quot;: &quot;success&quot;,
        &quot;resultReason&quot;: &quot;&quot;,
        &quot;targetResources&quot;: [
            {
                &quot;displayName&quot;: &quot;Sign-In Risk Policy&quot;,
                &quot;groupType&quot;: null,
                &quot;id&quot;: &quot;5bf6637e-056a-4f1c-b887-6c7e99ed5ac6&quot;,
                &quot;modifiedProperties&quot;: [
                    {
                        &quot;displayName&quot;: &quot;Included Updated Properties&quot;,
                        &quot;newValue&quot;: &quot;\&quot;\&quot;&quot;,
                        &quot;oldValue&quot;: null
                    }
                ],
                &quot;type&quot;: &quot;Policy&quot;,
                &quot;userPrincipalName&quot;: null
            }
        ],
        &quot;userAgent&quot;: null
    },
</code></pre></div>
<h3 id="responsible-disclosure"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#responsible-disclosure">Responsible disclosure</a></h3>
<p>After consideration and reading of what constitutes a security vulnerability at the Microsoft Security Response Center (MSRC), I do not believe that these deficiencies in auditing would be considered a security vulnerability, as the absence of audit data itself is not a vulnerability.</p>
<p>On July 26th, 2023, through an MVP channel in the Customer Connected Program Entra Advisors, I reached out to the Microsoft Entra Product Group wanting to provide feedback on what I believe are audit gaps in Entra ID.</p>
<p>After some exchanges to coordinate whom to send the feedback to, on August 7th I provided an email to the responsible parties in the PG covering audit logging. Microsoft did reply that they will investigate in response. Considering that this is not a security vulnerability, I do not believe there is harm in publishing this material prior to any (if any) changes occur on the part of Microsoft.</p>
<p>A case with Microsoft support has not been opened on this subject to this point, on which I would open one if directed by the PG.</p>
<h3 id="regarding-audit-log-analysis"><a class="toclink" href="../../2023/08/29/dude-wheres-my-audit-logs/#regarding-audit-log-analysis">Regarding audit log analysis</a></h3>
<p>In my endeavors to this point, I have not analyzed <strong>all</strong> audit log events in Entra ID, so there may still be additional gaps in what one might find to be acceptable auditing. While Microsoft may contend that they indicate in their own docs that some of these changes are not listed as being audited, I would counter that with the stances that every single configuration change in Entra ID should be audited <strong>and</strong> adhere to some sort of audit log schema for consistency.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-07-17 00:00:00+00:00">July 17, 2023</time></li>
        
        
          
          <li class="md-meta__item">
            
              11 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="protect-your-privilege-with-paw"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/">Protect Your Privilege with PAW</a></h2>
<p>According to the Microsoft Digital Defense Report 2022, weak identity controls are listed as a top three contributing factors found during ransomware incident response. One particularly troubling finding within identity controls is the lack of Privileged Access Workstations (PAW) found in any response engagement:</p>
<p><em>None of the impacted organizations implemented proper administrative credential segregation and least privilege access principals via dedicated workstations during the management of their critical identity and high-value assets, such as proprietary systems and business-critical applications.</em></p>
<p><em><a href="https://www.microsoft.com/en-us/security/business/microsoft-digital-defense-report-2022?WT.mc_id=SEC-MVP-5005105">Microsoft Digital Defense Report 2022, page 15 (Microsoft Digital Defense Report 2022 | Microsoft Security)</a></em></p>
<p>The report does not speculate as to <strong>why</strong> the organizations were not using PAW, but for anyone seasoned out there in the world of consultancy the answers will look like:</p>
<ul>
<li>Lack of time/budget/resources/priority</li>
<li>Lack of understanding and education</li>
<li>Lack of sufficient desire to change privileged administrative behavior</li>
<li>Belief that they have other sufficient compensating controls</li>
</ul>
<p>And these all really relate to each other – if you don’t understand what a PAW is, you can easily believe other solutions such as PIM or PAM will sufficiently fill the gap. Likewise, if you don’t understand how to articulate the value and principles behind PAW, it’s difficult to run it up the chain to ensure that it has priority. Even in those instances where you may have a decent understanding of PAW, but as an admin don’t want to change your working behavior – it’s understandable, it’s human to not want to change without knowing why.</p>
<p>Awareness is the first principle of ADKAR (<a href="https://www.prosci.com/resources/articles/why-the-adkar-model-works">The Prosci ADKAR Model: Why it Works</a>). May this article build that awareness, so you’ll come out of it with the second principle, desire.</p>
<h3 id="keeping-it-clean"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#keeping-it-clean">Keeping it clean</a></h3>
<p>One of the foundational components of privileged access is the clean source principle, which per Microsoft states:</p>
<p><em>The clean source principle requires all security dependencies to be as trustworthy as the object being secured.</em></p>
<p><em>Microsoft Learn, <a href="https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-success-criteria?WT.mc_id=SEC-MVP-5005105#clean-source-principle">Success criteria for privileged access strategy | Microsoft Learn</a></em></p>
<p>To phrase this another way, all components related to privileged access – the user accounts, the devices, the first- and third-party tools, all need to exist and be managed fully within the same security tier. Since the primary focus of PAW is for privileged access, that means everything related to PAW needs to be encompassed within the same tier as privileged access.</p>
<p>Microsoft documents this in their privileged access implementation documentation, and diagrams this out as follows:</p>
<p><img alt="Figure 1" src="/images/2023/07/17/img1.png" /></p>
<p><em>Note Privileged Security highlighted in the red box. Image courtesy Microsoft.</em></p>
<p>Those that are seasoned with Active Directory security may be more familiar with the Tiered access model, composed of Tier 0, Tier 1, and Tier 2, as diagrammed below:</p>
<p><img alt="Figure 2" src="/images/2023/07/17/img2.png" /></p>
<p><em>The Active Directory oriented privileged access model.</em></p>
<p>What is important to understand is that in the new model of privileged security, Tier 0 does not go away. There are subsets of privileged security – Tier 0 effectively becomes the control plane, encompassing all existing Tier 0 assets, such as Active Directory and related systems such as Azure AD Connect and AD FS. Tier 0 now includes the <strong>Control Plane</strong>, which is highly privileged access that provides control over all resources. The credentials associated with the control plane are<strong> Global Administrator</strong>, and users that hold roles which can <strong>directly</strong> or <strong>indirectly obtain control</strong> over a Global Administrator. It has become important to include these accounts in that realm of Tier 0 access, as we tend to only focus on Global Administrator. As an example, Privileged Authentication Administrator roles can be used to reset authentication information on all accounts in a tenant. Intune Administrators, in a cloud-managed PAW deployment, become encompassed in Tier 0, as they can manipulate and manage PAW devices. Tier 1 becomes the Management and Data and Workload planes and still includes the Server Admin role; still privileged, but importantly still separated from the control plan and Tier 0. While the focus on the part of Microsoft is very cloud-oriented, privilege separation and the delineation are still critical for Active Directory, as well as using PAW for Active Directory management – majority of enterprises will still be leaning on Active Directory for a good while. And speaking of Active Directory, for the organizations that have hybrid identity, where Active Directory and Azure AD are connected, organizations need to understand the paths of lateral movement and privilege escalation between the two identity providers; there are known attack paths where Active Directory can be leveraged to takeover Azure AD, as well as the opposite flow. These are just some examples, and role delineation and definition can be an article on its own – let me know if that would interest you. In the meantime, you can read about this evolution and how Microsoft defines it here, <a href="https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-access-model?WT.mc_id=SEC-MVP-5005105#evolution-from-the-legacy-ad-tier-model">Securing privileged access Enterprise access model | Microsoft Learn</a>.</p>
<p>Both models are still widely used and the principles behind them are valid. What is critical is that both models indicate that the <strong>device</strong> should be a PAW. Specifically, a <strong>physical device initiating session</strong>. The phrase clean keyboard may be thrown around at times as a bit of shorthand for the clean source principle.</p>
<h3 id="what-a-paw-is-not"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#what-a-paw-is-not">What a PAW is not</a></h3>
<p>Organizations may take shortcuts to PAW, either by implementing something “PAW like”, such as jump boxes or bastion hosts, or virtualizing their PAW. The term “cloud PAW” floats around out there, which assumptions made that it equates to deploying PAW as virtual desktops.</p>
<p>In all these scenarios you either run into:</p>
<ul>
<li>The chicken-and-egg problem</li>
<li>A tiering breach</li>
</ul>
<h4 id="bastion-hosts-jump-boxes-and-cloud-paw"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#bastion-hosts-jump-boxes-and-cloud-paw">Bastion hosts, jump boxes and cloud PAW</a></h4>
<p>Both bastion hosts and jump boxes can serve their purpose for managing resources, but they are not replacement for PAW. To adhere to the clean source principle, any remote access to a bastion host or jump box would need to be initiated from a device that already exists within the privileged security tier, otherwise you’ll encounter an upward tiering breach.</p>
<p><img alt="Figure 3" src="/images/2023/07/17/img3.png" /></p>
<p><em>Breaching tiers with a cloud-based solution such as bastion hosts or jump boxes</em></p>
<p>Even in the case where you may be used advanced technologies such as passwordless for authentication, some component of the authentication process will be local to the enterprise device, putting the privileged user account at risk of exposure on a lower tier.</p>
<p>And what about cloud PAW? This is a place of much confusion, as it’s a term thrown about that is derived from the Microsoft model of using <strong>cloud managed PAW</strong>. That managed word being the key piece – Microsoft documents how organizations can build and deploy PAW that are managed by Intune and joined to Azure AD. You can find that documentation here, <a href="https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment?WT.mc_id=SEC-MVP-5005105">Deploying a privileged access solution | Microsoft Learn</a>. As it goes with terminology, cloud managed PAW may sometimes be shortened to cloud PAW, and when people see cloud PAW, they presume that it means a PAW that exists within the cloud.</p>
<p>You’ll still find several articles and models out there where people attempt to build out a cloud-native PAW system, using things like Azure Virtual Desktop or Windows 365. And some of them <strong>might</strong> have an acceptable level of risk built into their design where there is enough monitoring and other compensating controls to minimize potential privileged access damage. Considering that ransomware can cost organizations millions of dollars in losses due to the inability to function, or even put them out of business, that’s the risk that needs to be factored in with something like a cloud PAW design. I’ve yet to see one that adheres to the clean source principle.</p>
<h4 id="virtualized-paw"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#virtualized-paw">Virtualized PAW</a></h4>
<p>Virtualizing your PAW results in the same series of issues as jump boxes and bastion hosts. Unless your virtualization environment is composed of resources that exist on and are managed in Tier 0, your Tier 1 administrators will be indirect administrators of those vPAW, and in turn access to other critical Tier 0 resources.</p>
<p><img alt="Figure 4" src="/images/2023/07/17/img4.png" /></p>
<p><em>Tier 1 admins can become Tier 0 admins through the management plane</em></p>
<p>It’s also important to consider the implications of not managing business critical Tier 1 resources from a PAW. We can expand our breach model out another layer and see that we are putting all resources at risk when we don’t use a physical PAW.</p>
<p><img alt="Figure 5" src="/images/2023/07/17/img5.png" /></p>
<p><em>The cascading tier breach with virtualized PAW</em></p>
<p>Some organizations may choose to run localized instances of virtualization software on their Enterprise devices, such as enabling Hyper-V within Windows 11. In these cases, the same problems apply: the enterprise user will still be authenticating with some mechanism local to the device with privileged credentials. The virtualized PAW will be susceptible to the same management plane attacks that would occur in an enterprise virtualization scenario.</p>
<p><img alt="Figure 6" src="/images/2023/07/17/img6.png" /></p>
<p><em>Localized virtualization of a vPAW breaching tiers</em></p>
<h3 id="why-pim-and-pam-compliment-but-do-not-replace-paw"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#why-pim-and-pam-compliment-but-do-not-replace-paw">Why PIM and PAM compliment, but do not replace, PAW</a></h3>
<p>PIM and PAM solutions are great mechanisms from a defense-in-depth perspective, but they do little to protect credentials once the credential is resident on the device in question.</p>
<p>A primary component of PAM solutions is password vaulting, which is great for granular control and auditing of who has access to secrets. Once that secret becomes resident on the device, however, it is as vulnerable as all the other credentials on the device. With more advanced and modern PAM solutions, there are mechanisms that provide a bastion host/jump box, to ensure that the vaulted credentials are not resident to the local device. However, you still will run into the same issues with bastion hosts and jump boxes – you still need to connect into the components providing this solution, which includes authenticating and creating a session. If you want to protect the session end-to-end, the source device still needs to adhere to the clean source principle, which in this case would be from a PAW.</p>
<p>PIM also compliments PAW but is not a replacement on its own. While PIM is great for providing the least standing privilege and enabling the use of just-in-time (JIT) privileges, once privileges are elevated in a system, any threat actor obtains your credentials, or a representation of them (such as tokens) will be able to act as you, with those elevated privileges.</p>
<h3 id="paw-greatly-reduces-the-surface-area-on-privileged-accounts"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#paw-greatly-reduces-the-surface-area-on-privileged-accounts">PAW greatly reduces the surface area on privileged accounts</a></h3>
<p>The purpose of a defense-in-depth model is to ensure that if one component fails, there are other components that will ensure that data, the core of every modern business, is not exposed to those who should not have access to that data.</p>
<p><img alt="Figure 7" src="/images/2023/07/17/img7.png" /></p>
<p><em>Defense-in-depth model</em></p>
<p>If we drill down into this model further, we will see that each layer is composed of several different technologies – especially when we are talking about privileged access to that data.</p>
<p>If we broke down the Identity &amp; Access layer of the model, we might see something like this:</p>
<p><img alt="Figure 8" src="/images/2023/07/17/img8.png" /></p>
<p><em>A breakdown of the Identity &amp; Access Management Layer concerning privileged credentials</em></p>
<p>PAW is foundational to the design theory of several other components – filling in the gaps PIM and PAM/secret vaulting present, but also building the strong foundation for which robust conditional access policies can be applied, device security policies can be pushed down from Intune, and account separation can be used to its fullest potential, ensuring that a mistake made with enterprise level credentials do not expose privileged creds.</p>
<h3 id="paw-doesnt-have-to-be-complex-to-deploy"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#paw-doesnt-have-to-be-complex-to-deploy">PAW doesn’t have to be complex to deploy</a></h3>
<p>As it goes with much of the privileged access documentation out there, there is the perception that everything is extremely time-consuming and overly complex. Organizations and security practitioners need to reshape their thinking relative to security privileged access, including the deployment of PAW.</p>
<p>Yes, depending on how your organization is structured, cloud managed PAW will require knocking down some silos between the teams that manage identity and devices within the organization; that’s work that should be happening anyway. Afterall, identity and device management practitioners are both security practitioners in modern environments.</p>
<p>As with most guidance though, starting somewhere is better than nowhere. Having an incremental approach and open mindset is a stronger security posture than saying if we can’t achieve 100% in x time, then it’s not worth doing at all.</p>
<p>If nothing else, justify the expense to procure some modern laptops to be used as the privileged devices for those Tier 0 Global Administrators and Domain Administrators, preferably one that is a secured-core device. You can find currently available ones here, <a href="https://www.microsoft.com/en-us/windows/business/windows-11-secured-core-computers?WT.mc_id=SEC-MVP-5005105">Windows 11 Secured-Core PCs | Microsoft</a>. The few thousand-dollar proactive expense is cheaper than the loss of business <strong>when</strong> your organization is breached. You can go one step further and configure some strong conditional access policies restricting what devices the privileged accounts can be used from. For details, see Filter for devices as a condition in <a href="https://learn.microsoft.com/en-us/azure/active-directory/conditional-access/concept-condition-filters-for-devices?WT.mc_id=SEC-MVP-5005105#create-a-conditional-access-policy">Conditional Access policy – Microsoft Entra | Microsoft Learn</a>.</p>
<p>Eventually though make sure you take the time to go through the entire process, found here, <a href="https://learn.microsoft.com/en-us/security/privileged-access-workstations/privileged-access-deployment?WT.mc_id=SEC-MVP-5005105">Deploying a privileged access solution | Microsoft Learn</a>.</p>
<h3 id="the-operational-change-shouldnt-be-a-showstopper"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#the-operational-change-shouldnt-be-a-showstopper">The Operational change shouldn’t be a showstopper</a></h3>
<p>Once deployed, and enforced, the biggest change in organizations is the operational impact on the privileged administrators. Yes, you may not be able to copypasta that PowerShell snippet you found on Stack Overflow as easily, but in our modern landscape we all must adapt to new ways of working. We made it through the drastic changes with remote work, and transitioning to PAW is much less impactful on the overall organization than that was – even if it doesn’t feel that way to your privileged admins.</p>
<p>Organizations need to make sure that they support the change, as there will be needed ramp up time, and it’s a suitable time to perform some incident handling testing to make sure administrators can perform all that they need to perform from their PAW. Organizations can be most vulnerable during an incident, whether it’s cyber, operational, or natural forces, and the mode of operation can’t be to just throw the PAW aside to fix things. Make sure that your IR, BC, and DR scenarios are reviewed and revised to support the use of PAW, as necessary.</p>
<h3 id="last-thoughts"><a class="toclink" href="../../2023/07/17/protect-your-privilege-with-paw/#last-thoughts">Last thoughts</a></h3>
<p>One of my favorite tag lines is from Johnathan Fox, a Sr. Security Consultant from Microsoft. The tag is “be a good admin and protect your privilege!”. Such a simple north star that we all should follow.</p>
<p>And if you’re an organization supporting your admins, make sure that you be a good organization and support your admins protecting their privilege. With the continually evolving landscape of threat actors, that protection is more critical than ever to ensuring that business doesn’t stop.</p>
    
  </div>
</article>
      
        <article class="md-post md-post--excerpt">
  <header class="md-post__header">
    
      <nav class="md-post__authors md-typeset">
        
          <span class="md-author">
            <img src="https://new.ericonidentity.com/images/crazy-eric.jpg" alt="Eric Woodruff">
          </span>
        
      </nav>
    
    <div class="md-post__meta md-meta">
      <ul class="md-meta__list">
        <li class="md-meta__item">
          <time datetime="2023-06-21 00:00:00+00:00">June 21, 2023</time></li>
        
        
          
          <li class="md-meta__item">
            
              4 min read
            
          </li>
        
      </ul>
      
    </div>
  </header>
  <div class="md-post__content md-typeset">
    <h2 id="the-noauth-flaw-is-a-symptom-of-industry-antipatterns"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/">The nOAuth “flaw” is a symptom of industry antipatterns</a></h2>
<p>If you haven’t followed the news recently, Descope released an article diving into how their security researchers were able to abuse OpenID Connect (OIDC) ID token claims to spoof the user they are authenticating as for multi-tenant SaaS applications. You can read their research article here, <a href="https://www.descope.com/blog/post/noauth">nOAuth: How Microsoft OAuth Misconfiguration Can Lead to Full Account Takeover (descope.com)</a>.</p>
<p>In conjunction with this, Microsoft has updated developer guidance for OpenID Connect and SAML assertions, and provided a blog post covering all of this, which can be found here, <a href="https://techcommunity.microsoft.com/t5/microsoft-entra-azure-ad-blog/the-false-identifier-anti-pattern/ba-p/3846013">The False Identifier Anti-pattern (microsoft.com)</a>.</p>
<p>Multi-tenant SaaS applications are those applications, such as Canva or Sessionize, which allow you to authenticate with your Microsoft or Office 365 account. Without getting off track, this is what allows SaaS application vendors to develop applications that can integrate with an organizations Azure Active Directory environment requiring no effort on the part of administrators.</p>
<p><img alt="Figure 1" src="/images/2023/06/21/img1.png" /></p>
<p><em>The Sessionize authentication screen allowing a user to select their identity provider.</em></p>
<p>And as it goes whenever there is a security problem, someone must fall on the sword. In this case Microsoft is taking the hit; unfortunately most new articles are incorrectly reporting on this as an Azure AD “flaw” that Microsoft had to “fix”. Kudos to Kurt Mackie (<a href="https://twitter.com/kurmac">@kurmac</a>) at Redmond Mag for being the only article to accurately report on this problem, which you can find here, <a href="https://redmondmag.com/articles/2023/06/21/azure-active-directory-noauth-attack-route.aspx?m=1">Microsoft Advises App Developers About ‘nOAuth’ Attack Route — Redmondmag.com</a>. To be fair, Microsoft isn’t completely innocent, as it took a case like this to really have them sharpen their guidance from a bit of a softer stance, but this is not really a technical flaw. I suppose we can’t blame others for not wanting to write articles about developers using antipatterns.</p>
<h3 id="the-real-flaw-starts-with-the-security-industry-letting-its-people-down"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/#the-real-flaw-starts-with-the-security-industry-letting-its-people-down">The real flaw starts with the security industry letting its people down</a></h3>
<p>So how exactly can we move from a technical problem to blaming the security industry as a whole? Microsoft speaks to the real flaw in their blog article – too many developers using antipatterns in software development for authentication and authorization. We can’t truly blame the developers, as we shouldn’t expect every developer to just magically be an expert at modern authentication. It’s difficult to even get identity practitioners to accurately describe the flows many times, so how can we point the finger at others.</p>
<h3 id="education-is-the-enemy-of-antipatterns-but-who-has-time-for-that"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/#education-is-the-enemy-of-antipatterns-but-who-has-time-for-that">Education is the enemy of antipatterns, but who has time for that</a></h3>
<p>The antipattern word is key here. Antipatterns are patterns that are common enough to become known, yet go against effective design. In this case, the antipattern is developers using the email claim within an ID token to make a “good enough” assessment of whom the user is.</p>
<p>Antipatterns develop when there is a lack of education, which both the security and software development industry are ripe with. We need every application to do more things faster and quicker and always operating in some perpetual state of beta to ship things quicker to beat the competition. And no, we don’t have time to slow down to understand what we are doing. Ship it now, fix it later, which is exactly what has happened in this case.</p>
<h3 id="the-silos-of-security-infrastructure-and-development-hinder-progress"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/#the-silos-of-security-infrastructure-and-development-hinder-progress">The silos of security, infrastructure, and development hinder progress</a></h3>
<p>The fact that most organizations still operate with varying degrees of silos is the secret everyone knows about but in most cases chooses to ignore.</p>
<p>For proper modern authentication development, we need developers that cross the boundaries between identity practitioner and coder. While logically most organizations can’t operate in a flat structure, we need to better adapt to remove these silos and let key players straddle the line. These key players need to be architects and engineers and developers who are allowed to cross-collaborate and want to cross-collaborate. If we enter a realm where identity security is dictated instead of collaborated, things rapidly break down.</p>
<p>This collaborative team should be proportionately sized to the organization, but whether you are an identity software vendor (ISV) or an enterprise that develops line-of-business (LOB) applications, you will still greatly benefit from the collaboration around identity implementations within your software.</p>
<h3 id="ignoring-the-need-for-change-continues-to-accrue-risk"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/#ignoring-the-need-for-change-continues-to-accrue-risk">Ignoring the need for change continues to accrue risk</a></h3>
<p>In the nOAuth case, the organizations selling SaaS applications were not named, and the problem was mitigated behind the scenes. But it’s a case of luck in that the “good team” was first to find the rampant use of these antipatterns. If things turned out worse, and account takeover has happened, it can become a very fast trip to the loss of consumer confidence and depending on your industry or geopolitical region regulator fines and other penalties, from data exfiltration and exposure. It also instills the fear, uncertainty, and doubt, in the industry, almost as a self-fulfilling prophecy that inhibits the industry to move forward. Imagine if your bank account could simply be taken over by someone spoofing your email address in a claim – it’s a fast route to never modernizing identity and leaving us in our current state of too many accounts, too many passwords, too many ways to authenticate, failing our end users.</p>
<h3 id="final-thoughts"><a class="toclink" href="../../2023/06/21/the-noauth-flaw-is-a-symptom-of-industry-antipatterns/#final-thoughts">Final Thoughts</a></h3>
<p>Start collaborating on identity within your organization across all the silos it touches. Prioritize education, for real this time. Your consumers will thank you for it, even if they don’t know they need to.</p>
    
  </div>
</article>
      
      
        
          



<nav class="md-pagination">
  
</nav>
        
      
    </div>
  </div>

          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.path", "navigation.top"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": {"NFC": "nfc"}, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../js/open_in_new_tab.js"></script>
      
    
  </body>
</html>